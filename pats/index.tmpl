{% extends "base_frame.tmpl" %}
{% block title %}Me{% endblock %}
{% block main_content %}
  <div class="jumbotron">
    <h1>{{ workspace_name }}</h1>
    <p class="lead">{{ workspace_id }}</p>
    <p><a class="btn btn-lg btn-primary" href="/toggl/update" role="button">更新！</a></p>
  </div>
  <div>
    <h2>Projects</h2>
    <p>
      {% for project in projects %}
	<span class="label label-info">{{ project.name }}</span>
      {% endfor %}
    </p>
    <h2>Tags</h2>
    <p>
      {% for tag in tags %}
	<code>{{ tag.name }}</code>
      {% endfor %}
    </p>

    <h2>Graph</h2>

    <canvas id="myChart" width="820" height="480"></canvas>

    <h2>Time Entries</h2>

    <table class="table table-striped" id="people-list">
      <thead>
	<th>项目+标签</th>
	<th>描述</th>
	<th>开始时间</th>
	<th>持续时间</th>
      </thead>
      <tbody>
	{% for entry in time_entries %}
	  <tr>
	    <td>
              <span class="label label-info">
                {{ projects_id_dict.get(entry.pid, {}).get("name") }}
              </span>
              &nbsp
	      {% if entry.tags %}
		{% for tag in entry.tags %}
		  {% if tag %}
		    <code>{{ tag }}</code>
		  {% endif %}
		{% endfor %}
	      {% endif %}
	    </td>
	    <td>{{ entry.description }}</td>
	    <td>{{ entry.start_time }}</td>
	    <td>{{ entry.duration }}</td>
	  </tr>
	{% endfor %}

      </tbody>
    </table>
  </div>
{% endblock %}
{% block tailjs %}
  {{ super() }}
  <script>
    $(function () {
        var data = {
	    labels : [{% for project in projects %}"{{ project.name }}", {% endfor %}],
	    datasets : [
		{
		    fillColor : "rgba(151,187,205,0.5)",
		    strokeColor : "rgba(151,187,205,1)",
		    pointColor : "rgba(151,187,205,1)",
		    pointStrokeColor : "#fff",
		    data : [{% for project in projects %}{{ summary[project.id] }}, {% endfor %}]
		},
	    ]
        }

        //Get the context of the canvas element we want to select
        var ctx = document.getElementById("myChart").getContext("2d");
        var myNewChart = new Chart(ctx).Line(data);
    });
  </script>
{% endblock %}
